BEGIN
    update nideshop_contract set status = 2,riding_status = 4 where end_time < DATE_FORMAT(DATE_SUB(NOW(), INTERVAL 7 DAY),'%Y-%m-%d %H:%i') and contract_type = 0 and status = 0;
		update nideshop_contract set status = 3,riding_status = 4 where end_time < DATE_FORMAT(DATE_SUB(NOW(), INTERVAL 7 DAY),'%Y-%m-%d %H:%i') and contract_type = 0 and status = 1;
		
		update nideshop_scheduling,nideshop_contract set nideshop_scheduling.status = 3 where nideshop_scheduling.id = nideshop_contract.scheduling_id and nideshop_contract.status = 3;

END



BEGIN
    update nideshop_contract set status = 2,riding_status = 4 where concat(end_date,' ',end_time) < DATE_FORMAT(DATE_SUB(NOW(), INTERVAL 7 DAY),'%Y-%m-%d %H:%i') and contract_type = 1 and status = 0;
		
		update nideshop_contract set status = 3,riding_status = 4 where concat(end_date,' ',end_time) < DATE_FORMAT(DATE_SUB(NOW(), INTERVAL 7 DAY),'%Y-%m-%d %H:%i') and contract_type = 1 and status = 1;
		
		update nideshop_scheduling,nideshop_contract set nideshop_scheduling.status = 3 where nideshop_scheduling.id = nideshop_contract.scheduling_id and nideshop_contract.status = 3;

END