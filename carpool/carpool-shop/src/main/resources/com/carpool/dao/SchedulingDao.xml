<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.carpool.dao.SchedulingDao">

    <resultMap type="com.carpool.entity.SchedulingEntity" id="schedulingMap">
        <result property="id" column="id"/>
        <result property="userId" column="user_id"/>
        <result property="imUserId" column="im_user_id"/>
        <result property="fromAddressId" column="from_address_id"/>
        <result property="toAddressId" column="to_address_id"/>
        <result property="schedulingCycle" column="scheduling_cycle"/>
        <result property="weekNum" column="week_num"/>
        <result property="arriveTime" column="arrive_time"/>
        <result property="subject" column="subject"/>
        <result property="status" column="status"/>
        <result property="contractId" column="contract_id"/>
        <result property="estTime" column="est_time"/>
        <result property="createTime" column="create_time"/>
    </resultMap>

    <select id="queryObject" resultType="com.carpool.entity.SchedulingEntity">
		select s.*, u.username as cjContractUsername, u.nickname as cjContractNickname, u.mobile as cjContractMobile, u.email as cjContractEmail 
		from nideshop_scheduling s 
		left join nideshop_contract c on c.id=s.contract_id
		left join nideshop_user u on u.id = c.user_id 
		where s.id = #{value}
	</select>

    <select id="queryList" resultType="com.carpool.entity.SchedulingEntity">
        select s.*, u.username as userName from nideshop_scheduling s  
        left join nideshop_user u on u.id = s.user_id
        WHERE 1=1
        <if test="subject != null and subject.trim() != ''">
            AND s.subject LIKE concat('%',#{subject},'%')
        </if>
        <if test="createTime != null and createTime.trim() != ''">
            AND DATE_FORMAT(s.create_time,'%Y-%m-%d') = #{createTime}
        </if>
        <choose>
            <when test="sidx != null and sidx.trim() != ''">
                order by ${sidx} ${order}
            </when>
            <otherwise>
                order by id desc
            </otherwise>
        </choose>
        <if test="offset != null and limit != null">
            limit #{offset}, #{limit}
        </if>
    </select>
    
    <select id="queryTotal" resultType="int">
        select count(*) from nideshop_scheduling
        WHERE 1=1
        <if test="subject != null and subject.trim() != ''">
            AND subject LIKE concat('%',#{subject},'%')
        </if>
        <if test="createTime != null and createTime.trim() != ''">
            AND create_time = #{createTime}
        </if>
    </select>

</mapper>